{
    "$schema": "http://json-schema.org/draft-07/schema",
    "$id": "https://raw.githubusercontent.com/HudoGriz/SV_coding_regions_benchmark_nextflow/master/nextflow_schema.json",
    "title": "SV Coding Regions Benchmark Pipeline Parameters",
    "description": "Comprehensive SV calling and benchmarking pipeline for multiple sequencing technologies",
    "type": "object",
    "definitions": {
        "input_files": {
            "title": "Input Files",
            "type": "object",
            "description": "Input files for the pipeline",
            "default": "",
            "properties": {
                "fasta": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "description": "Path to reference genome FASTA file",
                    "help_text": "Reference genome in FASTA format. Will be indexed if FAI index is not provided."
                },
                "fasta_fai": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "description": "Path to FAI index of reference genome (optional)",
                    "help_text": "If not provided, will be automatically generated from the FASTA file."
                },
                "illumina_wes_bam": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "description": "Path to Illumina WES BAM file (optional)",
                    "help_text": "Illumina whole-exome sequencing BAM file for short-read SV calling."
                },
                "illumina_wgs_bam": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "description": "Path to Illumina WGS BAM file (optional)",
                    "help_text": "Illumina whole-genome sequencing BAM file for short-read SV calling."
                },
                "pacbio_bam": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "description": "Path to PacBio HiFi BAM file (optional)",
                    "help_text": "PacBio HiFi long-read BAM file for long-read SV calling."
                },
                "ont_bam": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "description": "Path to Oxford Nanopore BAM file (optional)",
                    "help_text": "Oxford Nanopore long-read BAM file for long-read SV calling."
                },
                "benchmark_vcf": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "description": "Path to truth/benchmark VCF file",
                    "help_text": "Ground truth VCF file for benchmarking SV calls. Must be bgzipped and indexed."
                },
                "high_confidence_targets": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "description": "Path to high-confidence regions BED file (optional)",
                    "help_text": "BED file defining high-confidence genomic regions for focused analysis."
                },
                "gene_panel_targets": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "description": "Path to gene panel BED file (optional)",
                    "help_text": "BED file defining gene panel regions for targeted analysis."
                },
                "wes_utr_targets": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "description": "Path to WES with UTR regions BED file (optional)",
                    "help_text": "BED file defining exome capture regions including UTRs."
                },
                "tandem_repeats": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "description": "Path to tandem repeats BED file (optional)",
                    "help_text": "BED file with tandem repeat regions for filtering or annotation."
                }
            },
            "required": ["fasta", "benchmark_vcf"]
        },
        "tool_control": {
            "title": "Tool Control",
            "type": "object",
            "description": "Control which tools to run",
            "default": "",
            "properties": {
                "skip_pbsv": {
                    "type": "boolean",
                    "default": false,
                    "description": "Skip PBSV calling (for test data without proper PacBio headers)",
                    "help_text": "PBSV requires proper PacBio BAM headers. Set to true when using test data."
                },
                "skip_benchmarking": {
                    "type": "boolean",
                    "default": false,
                    "description": "Skip Truvari benchmarking",
                    "help_text": "Set to true to only run SV calling without benchmarking."
                }
            }
        },
        "simulation_parameters": {
            "title": "Simulation Parameters",
            "type": "object",
            "description": "Parameters for target region simulation",
            "default": "",
            "properties": {
                "simulate_targets": {
                    "type": "boolean",
                    "default": false,
                    "description": "Enable random target region simulation",
                    "help_text": "Simulate random combinations of genes to assess robustness."
                },
                "num_simulations": {
                    "type": "integer",
                    "default": 100,
                    "description": "Number of simulations to run",
                    "help_text": "Number of random target sets to generate and benchmark."
                },
                "gencode_gtf": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "description": "Path to GENCODE GTF annotation file (required for simulation)",
                    "help_text": "GTF file with gene annotations for extracting gene coordinates."
                }
            }
        },
        "analysis_parameters": {
            "title": "Analysis Parameters",
            "type": "object",
            "description": "Parameters for downstream analysis",
            "default": "",
            "properties": {
                "gather_statistics": {
                    "type": "boolean",
                    "default": false,
                    "description": "Generate aggregate statistics and plots",
                    "help_text": "Run analysis workflow to aggregate results and create visualizations."
                }
            }
        },
        "data_preparation": {
            "title": "Data Preparation",
            "type": "object",
            "description": "Parameters for automatic data download and preparation",
            "default": "",
            "properties": {
                "prepare_giab_resources": {
                    "type": "boolean",
                    "default": false,
                    "description": "Download GIAB truth sets and annotations only",
                    "help_text": "Minimal data preparation: downloads truth VCF and annotations."
                },
                "prepare_complete_data": {
                    "type": "boolean",
                    "default": false,
                    "description": "Download complete dataset including BAM files",
                    "help_text": "Full data preparation: downloads reference, BAMs, truth sets, and annotations."
                },
                "genome": {
                    "type": "string",
                    "default": "hs37d5",
                    "enum": ["hs37d5", "GRCh37", "GRCh38"],
                    "description": "Reference genome version for data preparation",
                    "help_text": "Choose genome version when using prepare_complete_data."
                },
                "skip_singularity_download": {
                    "type": "boolean",
                    "default": false,
                    "description": "Skip downloading Singularity containers (GRCh37 only)"
                },
                "skip_bam_download": {
                    "type": "boolean",
                    "default": false,
                    "description": "Skip downloading BAM files"
                },
                "skip_reference_download": {
                    "type": "boolean",
                    "default": false,
                    "description": "Skip downloading reference genome"
                },
                "download_grch37_liftover": {
                    "type": "boolean",
                    "default": false,
                    "description": "Download GRCh37 liftover truth sets (GRCh38 only)"
                },
                "project_dir": {
                    "type": "string",
                    "format": "directory-path",
                    "default": "${projectDir}",
                    "description": "Project directory for data preparation outputs"
                }
            }
        },
        "truvari_parameters": {
            "title": "Truvari Benchmarking Parameters",
            "type": "object",
            "description": "Parameters for Truvari benchmarking",
            "default": "",
            "properties": {
                "truvari_refdist": {
                    "type": "integer",
                    "default": 500,
                    "description": "Maximum reference location distance (bp)",
                    "help_text": "Maximum distance between SV breakpoints for comparison."
                },
                "truvari_pctsize": {
                    "type": "number",
                    "default": 0.7,
                    "description": "Minimum percent of SV size similarity (0-1)",
                    "help_text": "Variants must have at least this percent size similarity to be matched."
                },
                "truvari_pctseq": {
                    "type": "number",
                    "default": 0.7,
                    "description": "Minimum percent sequence similarity (0-1)",
                    "help_text": "Variants must have at least this percent sequence similarity to be matched."
                },
                "truvari_pctovl": {
                    "type": "number",
                    "default": 0.0,
                    "description": "Minimum percent reciprocal overlap (0-1)",
                    "help_text": "Variants must have at least this percent reciprocal overlap to be matched."
                },
                "truvari_passonly": {
                    "type": "boolean",
                    "default": false,
                    "description": "Only consider variants with PASS filter"
                },
                "truvari_multimatch": {
                    "type": "boolean",
                    "default": false,
                    "description": "Allow base variants to match multiple comparison variants"
                }
            }
        },
        "output_parameters": {
            "title": "Output Parameters",
            "type": "object",
            "description": "Output directory and run naming",
            "default": "",
            "properties": {
                "outdir": {
                    "type": "string",
                    "format": "directory-path",
                    "default": "./results",
                    "description": "Output directory for results",
                    "help_text": "The output directory where the results will be saved."
                },
                "run_name": {
                    "type": "string",
                    "default": "sv_benchmark",
                    "description": "Name for this pipeline run",
                    "help_text": "Used to name output files and reports."
                },
                "publish_dir_mode": {
                    "type": "string",
                    "default": "copy",
                    "enum": ["copy", "symlink", "link"],
                    "description": "Method for publishing output files"
                }
            }
        },
        "generic_options": {
            "title": "Generic Options",
            "type": "object",
            "description": "Less common options for the pipeline",
            "default": "",
            "properties": {
                "help": {
                    "type": "boolean",
                    "description": "Display help text",
                    "hidden": true
                },
                "version": {
                    "type": "boolean",
                    "description": "Display version and exit",
                    "hidden": true
                },
                "tracedir": {
                    "type": "string",
                    "default": "${params.outdir}/pipeline_info",
                    "description": "Directory to keep pipeline execution trace files"
                },
                "email": {
                    "type": "string",
                    "format": "email",
                    "description": "Email address for completion notification"
                },
                "plaintext_email": {
                    "type": "boolean",
                    "description": "Send plain-text email instead of HTML"
                }
            }
        },
        "resource_limits": {
            "title": "Resource Limits",
            "type": "object",
            "description": "Maximum resource limits",
            "default": "",
            "properties": {
                "max_cpus": {
                    "type": "integer",
                    "default": 16,
                    "description": "Maximum number of CPUs that can be requested"
                },
                "max_memory": {
                    "type": "string",
                    "default": "128.GB",
                    "pattern": "^\\d+(\\.\\d+)?\\.?\\s*(K|M|G|T)?B$",
                    "description": "Maximum amount of memory that can be requested"
                },
                "max_time": {
                    "type": "string",
                    "default": "240.h",
                    "pattern": "^(\\d+\\.?\\s*(s|m|h|d|day)\\s*)+$",
                    "description": "Maximum amount of time that can be requested"
                }
            }
        }
    },
    "allOf": [
        {"$ref": "#/definitions/input_files"},
        {"$ref": "#/definitions/tool_control"},
        {"$ref": "#/definitions/simulation_parameters"},
        {"$ref": "#/definitions/analysis_parameters"},
        {"$ref": "#/definitions/data_preparation"},
        {"$ref": "#/definitions/truvari_parameters"},
        {"$ref": "#/definitions/output_parameters"},
        {"$ref": "#/definitions/generic_options"},
        {"$ref": "#/definitions/resource_limits"}
    ]
}
