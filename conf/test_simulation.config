/*
========================================================================================
    Nextflow config file for testing simulation features
========================================================================================
    Defines test parameters for simulation and statistics generation
----------------------------------------------------------------------------------------
*/

params {
    // Test configuration metadata
    config_profile_name        = 'Simulation Test profile'
    config_profile_description = 'Test dataset to check simulation and statistics features'

    // Limit resources for testing
    max_cpus   = 2
    max_memory = '6.GB'
    max_time   = '6.h'

    // Input files - using test data in repository's test_data/ directory
    fasta = "${projectDir}/test_data/genome.fa"

    // BAM files - test with one technology only for speed
    illumina_wes_bam = "${projectDir}/test_data/illumina_wes.bam"
    illumina_wgs_bam = null
    pacbio_bam = null
    ont_bam = null

    // Truth VCF for benchmarking
    benchmark_vcf = "${projectDir}/test_data/truth.vcf.gz"

    // Target BED files
    high_confidence_targets = "${projectDir}/test_data/high_conf.bed"
    gene_panel_targets = "${projectDir}/test_data/gene_panel.bed"
    wes_utr_targets = "${projectDir}/test_data/wes_utr.bed"

    // Optional files
    tandem_repeats = null

    // Truvari parameters - relaxed for testing
    truvari_refdist = 1000
    truvari_pctsize = 0.5
    truvari_pctovl = 0
    truvari_pctseq = 0

    // Simulation parameters - ENABLED for this test
    simulate_targets = true
    num_simulations = 5  // Small number for fast testing
    gencode_gtf = "${projectDir}/test_data/gencode_test.gtf.gz"

    // Statistics parameters - ENABLED for this test
    gather_statistics = true

    // Output configuration
    outdir = 'test_results_simulation'
    run_name = 'test_simulation_run'
}

// Process-specific overrides for testing
process {
    cpus   = { check_max( 1, 'cpus' ) }
    memory = { check_max( 2.GB, 'memory' ) }
    time   = { check_max( 1.h, 'time' ) }
    
    // Override simulation with shorter timeout
    withName: 'SIMULATE_TARGETS' {
        cpus = 1
        memory = 1.GB
        time = 30.m
    }
    
    // Override statistics gathering
    withName: 'GATHER_STATISTICS' {
        cpus = 1
        memory = 2.GB
        time = 30.m
    }
}
