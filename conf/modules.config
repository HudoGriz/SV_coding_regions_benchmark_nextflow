/*
========================================================================================
    Module-specific container and configuration settings
========================================================================================
    Defines Docker/Singularity containers for each bioinformatics tool
    Only includes processes that actually exist in the pipeline
----------------------------------------------------------------------------------------
*/

process {
    
    // Samtools for BAM/FASTA indexing
    withName: 'SAMTOOLS_FAIDX' {
        container = 'quay.io/biocontainers/samtools:1.19.2--h50ea8bc_1'
    }
    
    // Manta for Illumina short-read SV calling
    withName: 'MANTA_GERMLINE' {
        container = 'quay.io/biocontainers/manta:1.6.0--h9ee0642_1'
    }
    
    withName: 'MANTA_WES' {
        container = 'quay.io/biocontainers/manta:1.6.0--h9ee0642_1'
    }
    
    withName: 'MANTA_WGS' {
        container = 'quay.io/biocontainers/manta:1.6.0--h9ee0642_1'
    }
    
    // PBSV for PacBio long-read SV calling
    withName: 'PBSV_DISCOVER' {
        container = 'quay.io/biocontainers/pbsv:2.9.0--h9ee0642_0'
    }
    
    withName: 'PBSV_CALL' {
        container = 'quay.io/biocontainers/pbsv:2.9.0--h9ee0642_0'
    }
    
    // Sniffles for long-read SV calling
    withName: 'SNIFFLES' {
        container = 'quay.io/biocontainers/sniffles:2.2--pyhdfd78af_0'
    }
    
    // cuteSV for long-read SV calling
    withName: 'CUTESV' {
        container = 'quay.io/biocontainers/cutesv:2.0.3--pyhdfd78af_0'
    }
    
    withName: 'CUTESV_PACBIO' {
        container = 'quay.io/biocontainers/cutesv:2.0.3--pyhdfd78af_0'
    }
    
    withName: 'CUTESV_ONT' {
        container = 'quay.io/biocontainers/cutesv:2.0.3--pyhdfd78af_0'
    }
    
    // Truvari for SV benchmarking (nf-core module)
    // Container is defined in the nf-core module
    withName: 'TRUVARI_BENCH' {
        ext.args = { "--passonly --dup-to-ins ${meta.truvari_args ?: ''}" }
        ext.prefix = { "${meta.technology}_${meta.tool}_${meta.target}" }
        publishDir = [
            path: { "${params.outdir}/real_intervals/${meta.technology}/truvari_benchmark/${meta.tool}/${meta.target}" },
            mode: 'copy',
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }
    
    // TABIX_BGZIPTABIX for VCF compression and indexing (nf-core module)
    // Container is defined in the nf-core module
    withName: 'BGZIP_TABIX.*' {
        ext.args2 = '-p vcf'
    }
    
    // Bedtools for region intersection
    withName: 'BEDTOOLS_INTERSECT' {
        container = 'quay.io/biocontainers/bedtools:2.31.1--hf5e1c6e_0'
    }
    
    // GUNZIP for decompression
    withName: 'GUNZIP' {
        container = 'quay.io/biocontainers/gzip:1.12'
    }
    
    // R-based processes for simulation and statistics
    // Using custom R environment from Singularity Library with required packages
    withName: 'SIMULATE_TARGETS' {
        container = 'library://blazv/benchmark-sv/r-env:4-4-1'
    }
    
    withName: 'GATHER_STATISTICS' {
        container = 'library://blazv/benchmark-sv/r-env:4-4-1'
    }
    
    // GIAB truth set download processes
    withName: 'DOWNLOAD_GIAB_TRUTH_SET' {
        container = 'quay.io/biocontainers/samtools:1.19.2--h50ea8bc_1'
    }
    
    withName: 'DOWNLOAD_GIAB_TRUTH_SET_GRCH38' {
        container = 'quay.io/biocontainers/samtools:1.19.2--h50ea8bc_1'
    }
    
    withName: 'DOWNLOAD_GIAB_TRUTH_SET_GRCH37_LIFTOVER' {
        container = 'quay.io/biocontainers/samtools:1.19.2--h50ea8bc_1'
    }
}
