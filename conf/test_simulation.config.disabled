/*
========================================================================================
    Nextflow config file for testing simulation features
========================================================================================
    Defines test parameters for simulation and statistics generation
----------------------------------------------------------------------------------------
*/

params {
    // Test configuration metadata
    config_profile_name        = 'Simulation Test profile'
    config_profile_description = 'Test dataset to check simulation and statistics features using nf-core test data'

    // Limit resources for testing
    max_cpus   = 2
    max_memory = '6.GB'
    max_time   = '6.h'

    // Base URL for nf-core test-datasets (modules branch)
    test_data_base = 'https://raw.githubusercontent.com/nf-core/test-datasets/modules/data'

    // Reference genome - chr22 subset (40kb region)
    fasta = "${test_data_base}/genomics/homo_sapiens/genome/genome.fasta"

    // BAM files - test with one technology only for speed
    illumina_wes_bam = "${test_data_base}/genomics/homo_sapiens/illumina/bam/test.paired_end.sorted.bam"
    illumina_wgs_bam = null
    pacbio_bam = null
    ont_bam = null

    // Use test VCF for simulation (not for actual benchmarking)
    // Simulation needs a VCF file to run, but we skip actual Truvari benchmarking
    // Using a germline resource VCF as a placeholder
    benchmark_vcf = "${test_data_base}/genomics/homo_sapiens/genome/vcf/dbsnp_146.hg38.vcf.gz"
    skip_benchmarking = true

    // Target BED files - using minimal test regions
    high_confidence_targets = "${test_data_base}/genomics/homo_sapiens/genome/genome.bed"
    gene_panel_targets = "${test_data_base}/genomics/homo_sapiens/genome/genome.bed"
    wes_utr_targets = "${test_data_base}/genomics/homo_sapiens/genome/genome.bed"

    // Optional files
    tandem_repeats = null

    // Truvari parameters - not used since benchmarking is skipped
    truvari_refdist = 1000
    truvari_pctsize = 0.5
    truvari_pctovl = 0
    truvari_pctseq = 0

    // Simulation parameters - ENABLED for this test
    simulate_targets = true
    num_simulations = 5  // Small number for fast testing
    gencode_gtf = "${projectDir}/test_data/gencode_test.gtf.gz"

    // Statistics parameters - ENABLED for this test
    gather_statistics = true

    // Output configuration
    outdir = 'test_results_simulation'
    run_name = 'test_simulation_run'
}

// Process-specific overrides for testing
process {
    cpus   = { check_max( 1, 'cpus' ) }
    memory = { check_max( 2.GB, 'memory' ) }
    time   = { check_max( 1.h, 'time' ) }
    
    // Override simulation with shorter timeout
    withName: 'SIMULATE_TARGETS' {
        cpus = 1
        memory = 1.GB
        time = 30.m
    }
    
    // Override statistics gathering
    withName: 'GATHER_STATISTICS' {
        cpus = 1
        memory = 2.GB
        time = 30.m
    }
}
